# -*- coding: utf-8 -*-
"""ë¹…ë°ì´í„°(ììœ¨ì£¼í–‰ AIì˜     ìœ¤ë¦¬ì  ë”œë ˆë§ˆ ë¶„ì„)

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1VfM1YDEYAkeupfkCA4MgLduM1fwJtkKa
"""

# ==========================================
# [Part 1] í™˜ê²½ ì„¤ì • ë° í•œê¸€ í°íŠ¸ ì„¤ì¹˜
# ==========================================
# ì‹œê°í™” ê·¸ë˜í”„ì—ì„œ í•œê¸€ì´ ê¹¨ì§€ì§€ ì•Šë„ë¡ 'ë‚˜ëˆ”ë°”ë¥¸ê³ ë”•' í°íŠ¸ë¥¼ ì„¤ì¹˜í•©ë‹ˆë‹¤.
!sudo apt-get install -y fonts-nanum
!sudo fc-cache -fv
!rm ~/.cache/matplotlib -rf

print("âœ… í°íŠ¸ ì„¤ì¹˜ ì™„ë£Œ! [Part 2]ë¥¼ ì‹¤í–‰í•˜ì—¬ ëŸ°íƒ€ì„ì„ ì¬ì‹œì‘í•´ì£¼ì„¸ìš”.")

# ==========================================
# [Part 2] ëŸ°íƒ€ì„ ìë™ ì¬ì‹œì‘ (í°íŠ¸ ì ìš©)
# ==========================================
import os
print("â³ í°íŠ¸ ì ìš©ì„ ìœ„í•´ ëŸ°íƒ€ì„ì„ ì¬ì‹œì‘í•©ë‹ˆë‹¤...")
os.kill(os.getpid(), 9)

import pandas as pd
# íŒŒì¼ëª…ì´ ì •í™•í•´ì•¼ í•©ë‹ˆë‹¤
df = pd.read_csv('CountriesChangePr.csv')
print(list(df.columns))

# Commented out IPython magic to ensure Python compatibility.
# ==========================================
# [Part 3] ë°ì´í„° êµ¬ì¶•: ì›ë³¸ ë°ì´í„° ë¡œë“œ ë° ì „ì²˜ë¦¬
# ==========================================
import pandas as pd
import numpy as np
import os
import matplotlib.pyplot as plt

# 1. ì‹œê°í™” í™˜ê²½ ì„¤ì •
# %config InlineBackend.figure_format = 'retina'
plt.rc('font', family='NanumBarunGothic')
plt.rcParams['axes.unicode_minus'] = False

print("â³ ì›ë³¸ CSV ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ì „ì²˜ë¦¬(ì •ì œ -> ë³€í™˜ -> ì •ê·œí™”) ì¤‘ì…ë‹ˆë‹¤...")

# -------------------------------------------------------
# Step 1. ì›ë³¸ ë°ì´í„° ë¡œë“œ (Data Loading)
# -------------------------------------------------------
csv_file = 'CountriesChangePr.csv'

if os.path.exists(csv_file):
    raw_df = pd.read_csv(csv_file)

    # [Big Data ê¸°ë²• 1] ë°ì´í„° í‘œì¤€í™”: ëª¨ë“  ì»¬ëŸ¼ëª…ì„ ì†Œë¬¸ìë¡œ í†µì¼ (ëŒ€ì†Œë¬¸ì ì˜¤ë¥˜ ë°©ì§€)
    raw_df.columns = raw_df.columns.str.lower()
    print(f"âœ… ì›ë³¸ íŒŒì¼ ë¡œë“œ ì„±ê³µ! (ì´ {len(raw_df)}ê°œ êµ­ê°€ ë°ì´í„°)")

    # -------------------------------------------------------
    # Step 2. ì»¬ëŸ¼ ë§¤í•‘ ë° ì •ì œ (Data Cleaning & Mapping)
    # -------------------------------------------------------
    # [Big Data ê¸°ë²• 2] ë³€ìˆ˜ ë§¤í•‘: ë³µì¡í•œ ì›ë³¸ ì»¬ëŸ¼ëª…ì„ ì§ê´€ì ì¸ ë¶„ì„ ìš©ì–´ë¡œ ë³€ê²½
    rename_map = {
        'unnamed: 0': 'ISO3',
        'age [elderly -> young]: estimates': 'save_young',        # ì Šì€ì´ ì„ í˜¸
        'law [illegal -> legal]: estimates': 'compliance',        # ë²•ê·œ ì¤€ìˆ˜
        'gender [male -> female]: estimates': 'save_female',      # ì—¬ì„± ì„ í˜¸
        'no. characters [less -> more]: estimates': 'save_many',  # ë‹¤ìˆ˜ ì„ í˜¸
        'fitness [large -> fit]: estimates': 'save_fit'           # ê±´ê°• ì„ í˜¸
    }
    df = raw_df.rename(columns=rename_map)

    # [Big Data ê¸°ë²• 3] íŒŒìƒ ë³€ìˆ˜ ìƒì„±: 'ë…¸ì¸ ì„ í˜¸' ì§€í‘œ ìƒì„± (ì Šì€ì´ ì„ í˜¸ì˜ ì—­ìˆ˜ ê°œë…)
    if 'save_young' in df.columns:
        df['save_elderly'] = -df['save_young']
    else:
        df['save_young'] = 0.5
        df['save_elderly'] = 0.5

    # -------------------------------------------------------
    # Step 3. ë°ì´í„° ìŠ¤ì¼€ì¼ë§ (Min-Max Scaling)
    # -------------------------------------------------------
    # [Big Data ê¸°ë²• 4] ì •ê·œí™”: ì„œë¡œ ë‹¤ë¥¸ ë²”ìœ„ì˜ ë°ì´í„°ë¥¼ 0~1 ì‚¬ì´ë¡œ ë³€í™˜í•˜ì—¬ ë¹„êµ ê°€ëŠ¥í•˜ê²Œ ë§Œë“¦
    cols_to_scale = ['save_young', 'save_elderly', 'compliance', 'save_female', 'save_many']

    for col in cols_to_scale:
        if col in df.columns:
            min_val = df[col].min()
            max_val = df[col].max()
            if max_val != min_val:
                df[col] = (df[col] - min_val) / (max_val - min_val)
            else:
                df[col] = 0.5
        else:
            df[col] = 0.5 # ê²°ì¸¡ ì»¬ëŸ¼ ì²˜ë¦¬

    # -------------------------------------------------------
    # Step 4. ë¶„ì„ ëŒ€ìƒ í•„í„°ë§ (Filtering)
    # -------------------------------------------------------
    # ë°ì´í„° ì‹ ë¢°ë„ê°€ í™•ë³´ëœ ì£¼ìš” 52ê°œêµ­ ì¶”ì¶œ
    target_iso = [
        'KOR', 'JPN', 'CHN', 'TWN', 'SGP', 'VNM', 'THA', 'IDN', 'PHL', 'MYS', 'IND', 'PAK', 'SAU', 'ARE', 'TUR', 'IRN', 'ISR', 'RUS', 'KAZ',
        'GBR', 'FRA', 'DEU', 'ITA', 'ESP', 'PRT', 'NLD', 'BEL', 'CHE', 'AUT', 'SWE', 'NOR', 'DNK', 'FIN', 'POL', 'CZE', 'HUN', 'GRC', 'IRL',
        'USA', 'CAN', 'MEX', 'BRA', 'ARG', 'CHL', 'COL', 'PER',
        'AUS', 'NZL', 'EGY', 'ZAF', 'NGA', 'KEN'
    ]

    if 'ISO3' in df.columns:
        df = df[df['ISO3'].isin(target_iso)].copy()

        # í•œê¸€ êµ­ê°€ëª… ë§¤í•‘ (ì‹œê°í™” ê°€ë…ì„± í–¥ìƒ)
        country_map = {
            'KOR': 'ëŒ€í•œë¯¼êµ­', 'JPN': 'ì¼ë³¸', 'CHN': 'ì¤‘êµ­', 'TWN': 'ëŒ€ë§Œ', 'SGP': 'ì‹±ê°€í¬ë¥´', 'VNM': 'ë² íŠ¸ë‚¨', 'THA': 'íƒœêµ­', 'IDN': 'ì¸ë„ë„¤ì‹œì•„', 'PHL': 'í•„ë¦¬í•€', 'MYS': 'ë§ë ˆì´ì‹œì•„',
            'IND': 'ì¸ë„', 'PAK': 'íŒŒí‚¤ìŠ¤íƒ„', 'SAU': 'ì‚¬ìš°ë””', 'ARE': 'UAE', 'TUR': 'í„°í‚¤', 'IRN': 'ì´ë€', 'ISR': 'ì´ìŠ¤ë¼ì—˜', 'RUS': 'ëŸ¬ì‹œì•„', 'KAZ': 'ì¹´ìíìŠ¤íƒ„',
            'GBR': 'ì˜êµ­', 'FRA': 'í”„ë‘ìŠ¤', 'DEU': 'ë…ì¼', 'ITA': 'ì´íƒˆë¦¬ì•„', 'ESP': 'ìŠ¤í˜ì¸', 'PRT': 'í¬ë¥´íˆ¬ê°ˆ', 'NLD': 'ë„¤ëœë€ë“œ', 'BEL': 'ë²¨ê¸°ì—', 'CHE': 'ìŠ¤ìœ„ìŠ¤', 'AUT': 'ì˜¤ìŠ¤íŠ¸ë¦¬ì•„',
            'SWE': 'ìŠ¤ì›¨ë´', 'NOR': 'ë…¸ë¥´ì›¨ì´', 'DNK': 'ë´ë§ˆí¬', 'FIN': 'í•€ë€ë“œ', 'POL': 'í´ë€ë“œ', 'CZE': 'ì²´ì½”', 'HUN': 'í—ê°€ë¦¬', 'GRC': 'ê·¸ë¦¬ìŠ¤', 'IRL': 'ì•„ì¼ëœë“œ',
            'USA': 'ë¯¸êµ­', 'CAN': 'ìºë‚˜ë‹¤', 'MEX': 'ë©•ì‹œì½”', 'BRA': 'ë¸Œë¼ì§ˆ', 'ARG': 'ì•„ë¥´í—¨í‹°ë‚˜', 'CHL': 'ì¹ ë ˆ', 'COL': 'ì½œë¡¬ë¹„ì•„', 'PER': 'í˜ë£¨',
            'AUS': 'í˜¸ì£¼', 'NZL': 'ë‰´ì§ˆëœë“œ', 'EGY': 'ì´ì§‘íŠ¸', 'ZAF': 'ë‚¨ì•„ê³µ', 'NGA': 'ë‚˜ì´ì§€ë¦¬ì•„', 'KEN': 'ì¼€ëƒ'
        }

        df['Country'] = df['ISO3'].map(country_map)
        df['Country'] = df['Country'].fillna(df['ISO3']) # ë§¤í•‘ ì‹¤íŒ¨ ì‹œ ì½”ë“œë¡œ ëŒ€ì²´

        # -------------------------------------------------------
        # Step 5. ìµœì¢… ë°ì´í„°ì…‹ ìƒì„±
        # -------------------------------------------------------
        final_cols = ['ISO3', 'Country'] + cols_to_scale
        df = df[final_cols]

        df.to_csv("moral_machine_final_data.csv", index=False)
        print(f"âœ… ì „ì²˜ë¦¬ ì™„ë£Œ! {len(df)}ê°œ êµ­ê°€ ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ì¶”ì¶œí–ˆìŠµë‹ˆë‹¤.")
        print(df.head()) # [PPT ìº¡ì²˜ìš©] ìµœì¢… ë°ì´í„° í‘œ í™•ì¸


    else:
        print("âŒ ì˜¤ë¥˜: 'ISO3' ì»¬ëŸ¼ ë§¤í•‘ ì‹¤íŒ¨. ì›ë³¸ ë°ì´í„° êµ¬ì¡°ë¥¼ í™•ì¸í•˜ì„¸ìš”.")
else:
    print(f"âŒ ì˜¤ë¥˜: '{csv_file}' íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")


df.head(10).style.background_gradient(cmap='Blues')

# ==========================================
# [Part 4] ê±°ì‹œ ë¶„ì„: ì „ ì„¸ê³„ ìœ¤ë¦¬ì  ì„±í–¥ ì§€ë„
# ==========================================
import plotly.express as px

print("â³ í‰ë©´ ì§€ë„ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...")

# 1. ì§€ë„ ì‹œê°í™” ìƒì„± (Choropleth Map)
fig = px.choropleth(
    df,
    locations="ISO3",
    color="save_young",
    hover_name="Country",
    color_continuous_scale='RdBu', # Red(ë™ì–‘/ë…¸ì¸) <-> Blue(ì„œì–‘/ì Šì€ì´)
    range_color=[0.3, 0.7],        # ìƒ‰ìƒ ëŒ€ë¹„ ìµœì í™”
    title="<b>[ê±°ì‹œ ë¶„ì„] ì „ ì„¸ê³„ ìœ¤ë¦¬ ì„±í–¥: ì Šì€ì´ ì„ í˜¸ë„ (Save Young)</b>",
    labels={'save_young': 'ì Šì€ì´ ì„ í˜¸ ì§€ìˆ˜'}
)

# 2. ë ˆì´ì•„ì›ƒ ì„¤ì • (í‰ë©´ ì§€ë„)
fig.update_layout(
    title_font_size=20,
    geo=dict(
        showframe=False,
        showcoastlines=True,
        projection_type='natural earth',
        showocean=True, oceancolor="#F0F8FF",
        showlakes=True, lakecolor="#F0F8FF"
    ),
    margin={"r":0,"t":50,"l":0,"b":0}
)

# 3. ì¶œë ¥ ì„¤ì • (ìŠ¤í¬ë¡¤ í™•ëŒ€ ë°©ì§€)
fig.show(config={
    'scrollZoom': False,
    'displayModeBar': True,
    'displaylogo': False
})

fig.write_html("moral_machine_map.html")
print("âœ… ì§€ë„ ìƒì„± ì™„ë£Œ! (ì˜¤ë¥¸ìª½ ìƒë‹¨ ì¹´ë©”ë¼ ì•„ì´ì½˜ìœ¼ë¡œ ë‹¤ìš´ë¡œë“œ)")

# ==========================================
# [Part 4-1] ë¨¸ì‹ ëŸ¬ë‹: K-Means í´ëŸ¬ìŠ¤í„°ë§ (ê·¸ë£¹ëª…/ìƒ‰ìƒ ì§€ì •)
# ==========================================
from sklearn.cluster import KMeans
import plotly.express as px

print("â³ AIê°€ êµ­ê°€ë“¤ì„ ì„±í–¥ë³„ë¡œ ê·¸ë£¹í™”í•˜ê³  ì´ë¦„ì„ ë¶™ì´ê³  ìˆìŠµë‹ˆë‹¤...")

# 1. í•™ìŠµ ë°ì´í„° ì¤€ë¹„
features = ['save_young', 'save_elderly', 'compliance', 'save_female', 'save_many']
X = df[features]

# 2. K-Means ëª¨ë¸ í•™ìŠµ
# random_state=42ë¡œ ê³ ì •í•˜ì—¬ ê²°ê³¼ê°€ ë°”ë€Œì§€ ì•Šê²Œ í•¨
kmeans = KMeans(n_clusters=3, random_state=42, n_init=10)
df['Cluster'] = kmeans.fit_predict(X)

# 3. ê·¸ë£¹ ì´ë¦„ ë§¤í•‘ (Naming)
# ì•„ê¹Œ ë‚˜ì˜¨ ê²°ê³¼(ë¯¸êµ­=0, ëŸ¬ì‹œì•„=1, ì¤‘êµ­=2)ë¥¼ ë°”íƒ•ìœ¼ë¡œ ì´ë¦„ ë¶€ì—¬
cluster_names = {
    0: 'ì„œêµ¬í˜•: íš¨ìœ¨/ë¯¸ë˜ ì¤‘ì‹œ',  # ë¯¸êµ­, ìœ ëŸ½ ìª½
    2: 'ë™ì–‘í˜•: ê·œë²”/ì§ˆì„œ ì¤‘ì‹œ',  # ì•„ì‹œì•„ ìª½
    1: 'ë³µí•©í˜•: ë³´í˜¸/ì¤‘ê°„ ì„±í–¥'   # ëŸ¬ì‹œì•„, ë‚¨ë¯¸ ìª½
}
df['Cluster_Label'] = df['Cluster'].map(cluster_names)

# 4. ìƒ‰ìƒ ì§€ì • (Color Mapping)
# ì„œì–‘=íŒŒë‘, ë™ì–‘=ë¹¨ê°•, ë‚˜ë¨¸ì§€=ì´ˆë¡
color_map = {
    'ì„œêµ¬í˜•: íš¨ìœ¨/ë¯¸ë˜ ì¤‘ì‹œ': '#1E88E5', # Blue
    'ë™ì–‘í˜•: ê·œë²”/ì§ˆì„œ ì¤‘ì‹œ': '#D32F2F', # Red
    'ë³µí•©í˜•: ë³´í˜¸/ì¤‘ê°„ ì„±í–¥': '#43A047'  # Green
}

# 5. ì§€ë„ ì‹œê°í™”
fig = px.choropleth(
    df,
    locations="ISO3",
    color="Cluster_Label",      # ê·¸ë£¹ ì´ë¦„ìœ¼ë¡œ ìƒ‰ì¹ 
    hover_name="Country",
    title="<b>[ë¨¸ì‹ ëŸ¬ë‹] AIê°€ ë¶„ë¥˜í•œ ë¬¸í™”ê¶Œë³„ ìœ¤ë¦¬ ì„±í–¥ ì§€ë„ (K-Means)</b>",
    color_discrete_map=color_map, # ìš°ë¦¬ê°€ ì •í•œ ìƒ‰ìƒ ì ìš©
    labels={'Cluster_Label': 'AI ë¶„ë¥˜ ê·¸ë£¹'} # ë²”ë¡€ ì œëª©
)

fig.update_layout(
    title_font_size=20,
    geo=dict(
        showframe=False, showcoastlines=True, projection_type='natural earth',
        showocean=True, oceancolor="#F0F8FF", showlakes=True, lakecolor="#F0F8FF"
    ),
    margin={"r":0,"t":50,"l":0,"b":0}
)

# 6. ì¶œë ¥ ë° ì €ì¥
fig.show(config={'scrollZoom': False, 'displayModeBar': True})
fig.write_html("moral_machine_kmeans_map.html")

print("âœ… ê·¸ë£¹ëª… ë³€ê²½ ì™„ë£Œ! ì§€ë„ì˜ ë²”ë¡€(Legend)ë¥¼ í™•ì¸í•˜ì„¸ìš”.")

# ---------------------------------------------------------
# [ì¶”ê°€] AIê°€ ë¶„ë¥˜í•œ ê·¸ë£¹ë³„ ì„±í–¥ í‰ê·  ì ìˆ˜
# ---------------------------------------------------------

# 1. ê·¸ë£¹ë³„ í‰ê·  ê³„ì‚°
group_means = df.groupby('Cluster_Label')[['save_young', 'compliance', 'save_elderly', 'save_many']].mean()

# 2. ì»¬ëŸ¼ ì´ë¦„ì„ í•œê¸€ë¡œ ë³€ê²½
kor_cols = {
    'save_young': 'ì Šì€ì´ ì„ í˜¸',
    'compliance': 'ë²•ê·œ ì¤€ìˆ˜',
    'save_elderly': 'ë…¸ì¸ ì„ í˜¸',
    'save_many': 'ë‹¤ìˆ˜ ì„ í˜¸'
}
group_means_ko = group_means.rename(columns=kor_cols)

# 3. ë³´ê¸° ì¢‹ê²Œ ìƒ‰ê¹” ì…í˜€ì„œ ì¶œë ¥
print("ğŸ“Š [AI ë¶„ë¥˜ ê·¸ë£¹ë³„ ì„±í–¥ í‰ê·  ì ìˆ˜]")
print("ğŸ‘‰ ìƒ‰ìƒì´ ì§„í• ìˆ˜ë¡ í•´ë‹¹ ì„±í–¥ì´ ê°•í•˜ë‹¤ëŠ” ëœ»ì…ë‹ˆë‹¤.")

display(group_means_ko.style.format("{:.2f}").background_gradient(cmap='Blues'))

# ==========================================
# [Part 4.5] ì¤‘ê°„ ë¶„ì„: ë¬¸í™”ê¶Œë³„ ëŒ€í‘œ êµ­ê°€ ì„ ì • (TOP 10)
# ==========================================
import matplotlib.pyplot as plt
import matplotlib.cm as cm
import numpy as np

print("â³ ì±”í”¼ì–¸ ì°¨íŠ¸ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...")

# 1. ë°ì´í„° ë¶„ë¦¬ (ë™ì–‘/ì„œì–‘)
asian_countries = ['KOR', 'JPN', 'CHN', 'TWN', 'SGP', 'VNM', 'THA', 'IDN', 'PHL', 'MYS', 'IND', 'PAK']
asian_mask = df['ISO3'].isin(asian_countries)
df_asia = df[asian_mask].copy()
df_west = df[~asian_mask].copy()

# 2. ì‹œê°í™” ì„¤ì •
fig, axes = plt.subplots(1, 2, figsize=(16, 8))
plt.subplots_adjust(wspace=0.3)

# â˜… ìƒ‰ìƒ ê·œì¹™ í†µì¼: ì„œì–‘(Blue) / ë™ì–‘(Red)
color_west_blue = '#1E88E5'
color_asia_red = '#D32F2F'

# ---------------------------------------------------------
# [ì™¼ìª½] ì„œì–‘ TOP 10: ì Šì€ì´ ì„ í˜¸ (íŒŒë€ìƒ‰ ê³„ì—´)
# ---------------------------------------------------------
top_west = df_west.sort_values(by='save_young', ascending=False).head(10)
countries = top_west['Country']
values = top_west['save_young']

# ê·¸ë¼ë°ì´ì…˜ ì ìš©
cmap_blue = cm.Blues
colors = cmap_blue(np.linspace(0.4, 1.0, len(values)))

axes[0].barh(countries, values, color=colors, edgecolor='white')
axes[0].set_title(f"ì„œì–‘ êµ­ê°€ TOP 10: 'ì Šì€ì´ ì„ í˜¸'\n(ë¶ìœ ëŸ½ ê°•ì„¸, ë¯¸êµ­ ìƒìœ„ê¶Œ)", fontsize=16, fontweight='bold', pad=15, color=color_west_blue)
axes[0].invert_yaxis()

# ë””ìì¸ ì •ë¦¬
for spine in ['top', 'right', 'bottom', 'left']:
    axes[0].spines[spine].set_visible(False)
axes[0].set_xticks([])
axes[0].tick_params(axis='y', length=0, labelsize=12)

# ìˆ˜ì¹˜ ë° ë¯¸êµ­ ê°•ì¡°
for i, v in enumerate(values):
    color = color_west_blue if countries.iloc[i] == 'ë¯¸êµ­' else '#555555'
    fontweight = 'bold' if countries.iloc[i] == 'ë¯¸êµ­' else 'normal'
    axes[0].text(v + 0.01, i, f'{v:.2f}', va='center', fontsize=11, fontweight=fontweight, color=color)
axes[0].set_xlim(0, 0.85)

# ---------------------------------------------------------
# [ì˜¤ë¥¸ìª½] ë™ì–‘ TOP 10: ë²•ê·œ ì¤€ìˆ˜ (ë¹¨ê°„ìƒ‰ ê³„ì—´)
# ---------------------------------------------------------
top_asia = df_asia.sort_values(by='compliance', ascending=False).head(10)
countries = top_asia['Country']
values = top_asia['compliance']

# ê·¸ë¼ë°ì´ì…˜ ì ìš©
cmap_red = cm.Reds
colors = cmap_red(np.linspace(0.4, 1.0, len(values)))

axes[1].barh(countries, values, color=colors, edgecolor='white')
axes[1].set_title(f"ë™ì–‘ êµ­ê°€ TOP 10: 'ë²•ê·œ ì¤€ìˆ˜'\n(ì¼ë³¸/ëŒ€í•œë¯¼êµ­ ìµœìƒìœ„)", fontsize=16, fontweight='bold', pad=15, color=color_asia_red)
axes[1].invert_yaxis()

for spine in ['top', 'right', 'bottom', 'left']:
    axes[1].spines[spine].set_visible(False)
axes[1].set_xticks([])
axes[1].tick_params(axis='y', length=0, labelsize=12)

# ìˆ˜ì¹˜ ë° í•œêµ­ ê°•ì¡°
for i, v in enumerate(values):
    color = color_asia_red if countries.iloc[i] == 'ëŒ€í•œë¯¼êµ­' else '#555555'
    fontweight = 'bold' if countries.iloc[i] == 'ëŒ€í•œë¯¼êµ­' else 'normal'
    axes[1].text(v + 0.01, i, f'{v:.2f}', va='center', fontsize=11, fontweight=fontweight, color=color)
axes[1].set_xlim(0, 1.0)

fig.suptitle("ì™œ 'ë¯¸êµ­(ì„œì–‘)'ê³¼ 'ëŒ€í•œë¯¼êµ­(ë™ì–‘)'ì¸ê°€?", fontsize=22, fontweight='bold', y=1.05)
plt.savefig("moral_machine_champions.png", dpi=300, bbox_inches='tight')
plt.show()

# ==========================================
# [Part 5] ë¯¸ì‹œ ë¶„ì„: ë²„í„°í”Œë¼ì´ ì°¨íŠ¸ (ë¯¸êµ­ vs ëŒ€í•œë¯¼êµ­)
# ==========================================
print("â³ ë²„í„°í”Œë¼ì´ ì°¨íŠ¸ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...")
import matplotlib.pyplot as plt
import numpy as np

# 1. ë°ì´í„° ì¤€ë¹„
target_cols = ['save_young', 'save_elderly', 'compliance', 'save_female', 'save_many']
labels = ['ì Šì€ì´ ì„ í˜¸', 'ë…¸ì¸ ì„ í˜¸', 'ë²•ê·œ ì¤€ìˆ˜', 'ì—¬ì„± ì„ í˜¸', 'ë‹¤ìˆ˜ ì„ í˜¸']
kor_values = df[df['ISO3'] == 'KOR'][target_cols].values.flatten().tolist()
usa_values = df[df['ISO3'] == 'USA'][target_cols].values.flatten().tolist()

# 2. ë””ìì¸ ì„¤ì •
color_kor_red = '#D32F2F'  # ëŒ€í•œë¯¼êµ­ (Red)
color_usa_blue = '#1E88E5' # ë¯¸êµ­ (Blue)
text_color = '#333333'

# 3. ê·¸ë˜í”„ ê·¸ë¦¬ê¸°
fig, ax = plt.subplots(figsize=(12, 7))
y = np.arange(len(labels))
height = 0.6

# ì™¼ìª½: ë¯¸êµ­ (Blue), ì˜¤ë¥¸ìª½: ëŒ€í•œë¯¼êµ­ (Red)
ax.barh(y, [-x for x in usa_values], height, color=color_usa_blue, label='ë¯¸êµ­', edgecolor='white', linewidth=1.5)
ax.barh(y, kor_values, height, color=color_kor_red, label='ëŒ€í•œë¯¼êµ­', edgecolor='white', linewidth=1.5)

# 4. ê¾¸ë¯¸ê¸°
for spine in ['top', 'right', 'bottom']:
    ax.spines[spine].set_visible(False)
ax.spines['left'].set_position('zero')
ax.spines['left'].set_color('#AAAAAA')
ax.grid(axis='x', linestyle='--', alpha=0.7, color='lightgray')
ax.set_xticks([])
ax.set_yticks(y)
ax.set_yticklabels(labels, fontsize=14, fontweight='bold', color=text_color)
ax.tick_params(axis='y', length=0)

# 5. ìˆ˜ì¹˜ í‘œì‹œ
for i, (k, u) in enumerate(zip(kor_values, usa_values)):
    ax.text(-u - 0.08, i, f'{u:.2f}', ha='center', va='center', color=color_usa_blue, fontweight='bold', fontsize=13)
    ax.text(k + 0.08, i, f'{k:.2f}', ha='center', va='center', color=color_kor_red, fontweight='bold', fontsize=13)

# 6. ì œëª© ë° ë²”ë¡€
plt.title('[ìƒì„¸ ë¹„êµ] ë¯¸êµ­(Left) vs ëŒ€í•œë¯¼êµ­(Right) ìœ¤ë¦¬ íŒë‹¨ ê¸°ì¤€', fontsize=20, pad=30, fontweight='bold', color=text_color)
handles, labels_legend = ax.get_legend_handles_labels()
ax.legend(handles, labels_legend, loc='lower center', bbox_to_anchor=(0.5, -0.15), ncol=2, fontsize=13, frameon=False)
plt.xlim(-1.1, 1.1)

plt.savefig("moral_machine_butterfly_design.png", dpi=300, bbox_inches='tight')
plt.show()